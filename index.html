<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Karkat by tetrapus</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Karkat</h1>
          <h2>Multithreaded python IRC socket bot.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/tetrapus/Karkat/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/tetrapus/Karkat/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/tetrapus/Karkat" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a name="karkat" class="anchor" href="#karkat"><span class="octicon octicon-link"></span></a>Karkat</h1>

<p>Multithreaded python IRC socket bot.
Warning: This readme may be out of date. Karkat is undergoing thorough modifications to his plugin structure. The majority of former features are currently not ported to the new interface- this is reasonably easy to do, but I have not done so as I am cleaning them all up before re-adding them. Please be patient, and feel free to do it yourself.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<h3>
<a name="step-1-download-dependencies" class="anchor" href="#step-1-download-dependencies"><span class="octicon octicon-link"></span></a>Step 1: Download dependencies</h3>

<p>If not already installed, the following packages must be installed:</p>

<ul>
<li>Docopt</li>
<li>Requests</li>
<li>PyYaml</li>
<li>PyLast</li>
</ul><p>Run <code>sudo pip3 install docopt pyyaml requests pylast</code> to install them.</p>

<h3>
<a name="step-2-create-server-config" class="anchor" href="#step-2-create-server-config"><span class="octicon octicon-link"></span></a>Step 2: Create server config</h3>

<p>Create a config file. A sample file (Sample.yaml) is provided. For convenience, a config generator mkconf.py is provided.</p>

<h3>
<a name="step-3-make-api-keys-optional" class="anchor" href="#step-3-make-api-keys-optional"><span class="octicon octicon-link"></span></a>Step 3: Make api keys (optional)</h3>

<p>Some modules require api keys. Create a file apikeys.conf in the config directory. Put your keys in there in the format specified by the module.
For the keys currently required to get karkat to run, the format is:</p>

<pre><code>bit.ly:
    user: USERNAME
    key: APIKEY
youtube:
    channel: CHANNEL-STRING
    appid: APPID
    secret: SECRET
wolfram:
    key: API_KEY
last.fm:
    key: API_KEY
    secret: API_SECRET
</code></pre>

<h3>
<a name="step-4-run-karkat" class="anchor" href="#step-4-run-karkat"><span class="octicon octicon-link"></span></a>Step 4: Run karkat</h3>

<p>Karkat is run via <code>./karkat.py &lt;config&gt;</code>. Other options are available, see the full argspec via ./karkat.py -h.</p>

<h2>
<a name="files" class="anchor" href="#files"><span class="octicon octicon-link"></span></a>Files</h2>

<h3>
<a name="karkatpy" class="anchor" href="#karkatpy"><span class="octicon octicon-link"></span></a>karkat.py</h3>

<p>This file loads all the plugins and spawns the server object. You may put code to replace the plugin system here (if, e.g you want to run a different bot's plugins on it).</p>

<p>The information below this point is outdated.</p>

<h3>
<a name="threadspy" class="anchor" href="#threadspy"><span class="octicon octicon-link"></span></a>threads.py</h3>

<p>This file contains the threads Karkat uses to operate. For every connection:</p>

<ul>
<li>There is 1 Printer thread and 1 Connection thread. Currently, the connection thread doesn't actually exist and is just stuck at the bottom of <code>karkat.py</code>
</li>
<li>There is a dynamic-sized array of Caller threads, as dictated by the <code>GP_CALLERS</code> constant defined in <code>karkat.py</code>
</li>
</ul><h3>
<a name="ircpy" class="anchor" href="#ircpy"><span class="octicon octicon-link"></span></a>irc.py</h3>

<p>This file contains some helper functions to parse IRC messages. The callback class provides some decorators which affect the behaviour of how a callback is handled by the connection thread.</p>

<h3>
<a name="textpy" class="anchor" href="#textpy"><span class="octicon octicon-link"></span></a>text.py</h3>

<p>This file contains some general text manipulation utilities. The design aesthetic of Karkat encourages short, multi-line output over information-dense, word-wrapped output.</p>

<h3>
<a name="featurespy" class="anchor" href="#featurespy"><span class="octicon octicon-link"></span></a>features.py</h3>

<p>All of the like, features are here. Currently they're just <code>execfile()</code>'d after everything else is defined, so uh, be careful with that.</p>

<p>It also only is run if the -f flag is passed in for some reason.</p>

<h2>
<a name="defining-a-callback" class="anchor" href="#defining-a-callback"><span class="octicon octicon-link"></span></a>Defining a callback</h2>

<p>The basic callback takes the arguments <code>(words, line)</code> where words is the line split by spaces, and line is the raw line from the server. Put the function in the corresponding entry in flist (where the keys are <code>.lower()</code>'d <code>word[1]</code>s).</p>

<h3>
<a name="decorators" class="anchor" href="#decorators"><span class="octicon octicon-link"></span></a>Decorators</h3>

<ul>
<li>
<code>@Callback.threadsafe</code> 
marks a function as threadsafe, which allows it to utilise the extra callables.</li>
<li>
<code>@Callback.background</code>
marks a function as a background function (i.e low priority) which sticks it in an alternate caller.</li>
<li>
<code>@Callback.msghandler</code>
changes the function signature of the callback to <code>(Address, context, Message)</code>
</li>
</ul><p>Only works for callbacks of the form ":Address TYPE target :message" </p>

<ul>
<li>
<code>@command(trigger, args=None or regexp, key=str.lower, help=None or str)</code>
changes the function signature of the callback to <code>(message, [arg1, arg2...])</code>
</li>
</ul><p>Triggers the function only when the data matches the form <code>[!@]trigger regexp</code>.</p>

<p><code>trigger</code> may be a string or a list of triggers. The key kwarg can be used to specify the key for what triggers are considered equivelant.</p>

<p><code>args</code> is a regular expression, with each group representing a new argument to give to the function. If None, no argument is matched.</p>

<p><code>help</code> is a string sent in place of the function's output if trigger matches, but args do not.</p>

<p>Only works for NOTICEs and PRIVMSGs</p>

<h2>
<a name="debugging-mode" class="anchor" href="#debugging-mode"><span class="octicon octicon-link"></span></a>Debugging mode</h2>

<p>Debugging mode can be enabled with the <code>-d [threshhold]</code> option. This sends server input to stdout, as well as provides warnings when the dispatcher loop takes longer than 0.15 or <code>threshhold</code> seconds to complete.</p>

<p>Karkat also provides two interpretters, a bash one which may be used by sending <code>$ COMMAND</code> to the bot, or a python interpretter with access to the global namespace via <code>&gt;&gt;&gt; command</code> or <code>"""command"""</code>. Note: bolded text will be messaged back to the sending context.</p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features:</h2>

<ul>
<li>A list of features is available at <a href="http://www.tetrap.us/karkat">http://www.tetrap.us/karkat</a>
</li>
</ul><p>Karkat's base system is undergoing renovations. Better documentation will be made available when the callback system is completed.</p>
        </section>

        <footer>
          Karkat is maintained by <a href="https://github.com/tetrapus">tetrapus</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>